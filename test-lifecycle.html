<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ç”Ÿå‘½å‘¨æœŸæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #667eea;
            text-align: center;
        }
        .box {
            border: 2px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: #f9f9ff;
        }
        .log {
            background: #1e1e1e;
            color: #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log div {
            padding: 3px 0;
            border-bottom: 1px solid #333;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #5568d3;
        }
        .danger {
            background: #f44336;
        }
        .danger:hover {
            background: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ç”Ÿå‘½å‘¨æœŸé’©å­æµ‹è¯•</h1>
        <p style="text-align: center; color: #666;">
            æµ‹è¯• onMounted å’Œ onUnmounted ç”Ÿå‘½å‘¨æœŸ
        </p>

        <div class="box">
            <h3>ğŸ“‹ æ—¥å¿—</h3>
            <div class="log" id="logs"></div>
        </div>

        <div class="box">
            <h3>ğŸ® æ§åˆ¶é¢æ¿</h3>
            <button onclick="mountComponent()">â• æŒ‚è½½ç»„ä»¶</button>
            <button onclick="unmountComponent()" class="danger">â– å¸è½½ç»„ä»¶</button>
            <button onclick="clearLogs()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div id="app"></div>
    </div>

    <script src="reactive-lit.js"></script>
    <script>
        const { html, createComponent, useState, onMounted, onUnmounted } = window.ReactiveLit;

        const logs = [];
        function log(msg, color = '#4caf50') {
            const time = new Date().toLocaleTimeString();
            logs.push(`<div style="color: ${color}">[${time}] ${msg}</div>`);
            document.getElementById('logs').innerHTML = logs.join('');
            document.getElementById('logs').scrollTop = document.getElementById('logs').scrollHeight;
        }

        function clearLogs() {
            logs.length = 0;
            document.getElementById('logs').innerHTML = '';
        }

        // åˆ›å»ºæµ‹è¯•ç»„ä»¶
        createComponent('lifecycle-test', () => {
            log('ğŸ¬ Setup å‡½æ•°æ‰§è¡Œï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰', '#ff9800');
            
            const count = useState(0);
            const setupTime = new Date().toLocaleTimeString();
            
            // å®šæ—¶å™¨å¼•ç”¨
            let timer = null;
            
            // onMounted é’©å­
            onMounted(() => {
                log('âœ… onMounted: ç»„ä»¶å·²æŒ‚è½½åˆ° DOM', '#4caf50');
                
                // å¯åŠ¨å®šæ—¶å™¨
                timer = setInterval(() => {
                    count(count() + 1);
                    log(`â±ï¸  å®šæ—¶å™¨è§¦å‘ï¼Œcount = ${count()}`, '#2196f3');
                }, 2000);
                
                log(`â° å®šæ—¶å™¨å·²å¯åŠ¨ (ID: ${timer})`, '#2196f3');
            });
            
            // onUnmounted é’©å­
            onUnmounted(() => {
                log('âŒ onUnmounted: ç»„ä»¶å³å°†å¸è½½', '#f44336');
                
                // æ¸…ç†å®šæ—¶å™¨
                if (timer) {
                    clearInterval(timer);
                    log(`ğŸ›‘ å®šæ—¶å™¨å·²æ¸…ç† (ID: ${timer})`, '#f44336');
                }
            });
            
            log('ğŸ“ Setup å®Œæˆï¼Œè¿”å›æ¸²æŸ“å‡½æ•°', '#ff9800');
            
            // è¿”å›æ¸²æŸ“å‡½æ•°
            return () => {
                log('ğŸ¨ æ¸²æŸ“å‡½æ•°æ‰§è¡Œ', '#9c27b0');
                
                return html`
                    <div class="box" style="background: #e3f2fd; border-color: #2196f3;">
                        <h3 style="color: #2196f3;">ğŸ§ª æµ‹è¯•ç»„ä»¶</h3>
                        <div style="padding: 15px; background: white; border-radius: 5px;">
                            <p><strong>Setup æ—¶é—´:</strong> ${setupTime}</p>
                            <p><strong>å½“å‰è®¡æ•°:</strong> <span style="font-size: 24px; color: #667eea; font-weight: bold;">${count()}</span></p>
                            <p style="color: #666; font-size: 14px;">
                                è®¡æ•°å™¨æ¯ 2 ç§’è‡ªåŠ¨å¢åŠ ä¸€æ¬¡<br>
                                å¸è½½ç»„ä»¶æ—¶ä¼šæ¸…ç†å®šæ—¶å™¨
                            </p>
                            <button onClick=${() => count(count() + 1)}>
                                â• æ‰‹åŠ¨å¢åŠ 
                            </button>
                            <button onClick=${() => count(0)} style="background: #ff9800;">
                                ğŸ”„ é‡ç½®
                            </button>
                        </div>
                    </div>
                `;
            };
        });

        let componentMounted = false;

        function mountComponent() {
            if (componentMounted) {
                log('âš ï¸  ç»„ä»¶å·²ç»æŒ‚è½½', '#ff9800');
                return;
            }
            
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', '#666');
            log('ğŸ“Œ å¼€å§‹æŒ‚è½½ç»„ä»¶...', '#ff9800');
            
            document.getElementById('app').innerHTML = '<lifecycle-test></lifecycle-test>';
            componentMounted = true;
            
            setTimeout(() => {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', '#666');
            }, 100);
        }

        function unmountComponent() {
            if (!componentMounted) {
                log('âš ï¸  æ²¡æœ‰ç»„ä»¶éœ€è¦å¸è½½', '#ff9800');
                return;
            }
            
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', '#666');
            log('ğŸ—‘ï¸  å¼€å§‹å¸è½½ç»„ä»¶...', '#ff9800');
            
            document.getElementById('app').innerHTML = '';
            componentMounted = false;
            
            setTimeout(() => {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', '#666');
            }, 100);
        }

        // åˆå§‹åŒ–
        log('ğŸ‰ é¡µé¢åŠ è½½å®Œæˆ', '#4caf50');
        log('ğŸ’¡ ç‚¹å‡»"æŒ‚è½½ç»„ä»¶"æŒ‰é’®å¼€å§‹æµ‹è¯•', '#666');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', '#666');
    </script>
</body>
</html>

