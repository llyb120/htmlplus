<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ‹¦æˆªè°ƒè¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-size: 12px;
        }
        .log {
            background: #2d2d2d;
            padding: 3px 8px;
            margin: 1px 0;
            border-left: 3px solid #666;
        }
        .track { border-left-color: #2196f3; }
        .trigger { border-left-color: #f44336; }
        .render { border-left-color: #4caf50; font-size: 13px; font-weight: bold; }
        .action { border-left-color: #ff9800; font-weight: bold; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        #display {
            background: #2d2d2d;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #4caf50;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æ‹¦æˆªè°ƒè¯•</h1>
    <div id="display"></div>
    <div id="logs" style="max-height: 500px; overflow-y: auto;"></div>

    <script src="reactive-lit.js"></script>
    
    <script>
        const logs = [];
        function addLog(msg, type = 'log') {
            logs.push({ msg, type });
            const el = document.getElementById('logs');
            el.innerHTML = logs.map(l => `<div class="log ${l.type}">${l.msg}</div>`).join('');
            el.scrollTop = el.scrollHeight;
        }

        const { html, createComponent, useState } = window.ReactiveLit;
        const debug = window.__reactive_debug__;
        
        addLog('âœ… æ¡†æ¶åŠ è½½å®Œæˆ', 'log');
        addLog(`è°ƒè¯•å¯¹è±¡: ${Object.keys(debug).join(', ')}`, 'log');

        // æ‹¦æˆª track å’Œ trigger
        const originalTrack = debug.track;
        const originalTrigger = debug.trigger;
        
        debug.track = function(target, key) {
            const targetDesc = Array.isArray(target) ? 'Array' : (target.constructor?.name || 'Object');
            addLog(`  ğŸ“˜ track(${targetDesc}, "${key}")`, 'track');
            return originalTrack.call(this, target, key);
        };
        
        debug.trigger = function(target, key) {
            const targetDesc = Array.isArray(target) ? 'Array' : (target.constructor?.name || 'Object');
            addLog(`  ğŸ”” trigger(${targetDesc}, "${key}")`, 'trigger');
            return originalTrigger.call(this, target, key);
        };

        let renderCount = 0;

        createComponent('test-comp', () => {
            renderCount++;
            addLog(`â”â”â”â” ğŸ¬ æ¸²æŸ“ #${renderCount} â”â”â”â”`, 'render');
            
            const arr = useState([1, 2, 3]);
            addLog(`åˆ›å»º arr state`, 'log');
            
            const obj = useState({ a: 1, b: 2 });
            addLog(`åˆ›å»º obj state`, 'log');
            
            addLog(`å¼€å§‹æ„å»ºæ¨¡æ¿...`, 'log');

            const result = html`
                <div>
                    <h2>æ¸²æŸ“ #${renderCount}</h2>
                    <h3>arr = [${arr().join(', ')}]</h3>
                    <h3>obj = ${JSON.stringify(obj())}</h3>
                    
                    <button onClick=${() => {
                        addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'action');
                        addLog('ğŸ”´ ç‚¹å‡»: arr().push(999)', 'action');
                        
                        const a = arr();
                        addLog(`  arr() è¿”å›: ${a}, å“åº”å¼=${a.__isReactive}`, 'log');
                        addLog(`  è°ƒç”¨ push...`, 'log');
                        
                        a.push(999);
                        
                        addLog(`  push å®Œæˆ`, 'log');
                        addLog(`  å½“å‰ arr: [${a}]`, 'log');
                    }}>arr().push(999)</button>
                    
                    <button onClick=${() => {
                        addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'action');
                        addLog('ğŸ”µ ç‚¹å‡»: obj().a++', 'action');
                        
                        const o = obj();
                        addLog(`  obj() è¿”å›: ${JSON.stringify(o)}, å“åº”å¼=${o.__isReactive}`, 'log');
                        addLog(`  æ‰§è¡Œ a++...`, 'log');
                        
                        o.a++;
                        
                        addLog(`  a++ å®Œæˆ`, 'log');
                        addLog(`  å½“å‰ obj: ${JSON.stringify(o)}`, 'log');
                    }}>obj().a++</button>
                    
                    <button onClick=${() => {
                        addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'action');
                        addLog('ğŸŸ¢ ç‚¹å‡»: arr([...arr(), 888])', 'action');
                        arr([...arr(), 888]);
                        addLog('  é‡æ–°èµ‹å€¼å®Œæˆ', 'log');
                    }}>é‡æ–°èµ‹å€¼</button>
                </div>
            `;
            
            return result;
        });

        document.getElementById('display').innerHTML = '<test-comp></test-comp>';
        
        setTimeout(() => {
            addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'log');
            addLog('ğŸ‰ åˆå§‹åŒ–å®Œæˆï¼', 'log');
            addLog(`targetMap size: ${debug.targetMap ? 'WeakMap' : 'N/A'}`, 'log');
            addLog(`parentMap size: ${debug.parentMap ? 'WeakMap' : 'N/A'}`, 'log');
        }, 100);
    </script>
</body>
</html>

