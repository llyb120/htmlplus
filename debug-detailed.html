<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¯¦ç»†è°ƒè¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .log {
            background: #2d2d2d;
            padding: 5px 10px;
            margin: 2px 0;
            border-left: 3px solid #007acc;
            font-size: 12px;
        }
        .error { border-left-color: #f44336; color: #f44336; }
        .success { border-left-color: #4caf50; color: #4caf50; }
        .warning { border-left-color: #ff9800; color: #ff9800; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        #display {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #4caf50;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è¯¦ç»†è°ƒè¯•</h1>
    <div id="display">ç­‰å¾…åˆå§‹åŒ–...</div>
    <div id="logs" style="max-height: 400px; overflow-y: auto;"></div>

    <script>
        const logs = [];
        function log(message, type = 'log') {
            const time = new Date().toLocaleTimeString();
            logs.push({ time, message, type });
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = logs.map(l => 
                `<div class="log ${l.type}">[${l.time}] ${l.message}</div>`
            ).join('');
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // å…ˆè®°å½•åŸå§‹å‡½æ•°
        log('ğŸ“¦ å¼€å§‹åŠ è½½ reactive-lit.js...', 'warning');
    </script>
    
    <script src="reactive-lit.js"></script>
    
    <script>
        log('âœ… reactive-lit.js åŠ è½½å®Œæˆ', 'success');
        
        const { html, createComponent, useState } = window.ReactiveLit;
        log('âœ… è§£æ„ API å®Œæˆ', 'success');

        // æ‹¦æˆª track å’Œ trigger æ¥æŸ¥çœ‹è°ƒç”¨
        let trackCalls = [];
        let triggerCalls = [];
        let renderCount = 0;

        createComponent('debug-component', () => {
            renderCount++;
            log(`ğŸ¬ ç»„ä»¶æ¸²æŸ“ #${renderCount}`, 'warning');
            
            const arr = useState([1, 2, 3]);
            log(`  â”œâ”€ arr åˆå§‹åŒ–/è¯»å–: [${arr()}]`);
            
            const obj = useState({ a: 1 });
            log(`  â””â”€ obj åˆå§‹åŒ–/è¯»å–: ${JSON.stringify(obj())}`);

            const handlePush = () => {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'warning');
                log('ğŸ”´ ç‚¹å‡» push æŒ‰é’®', 'error');
                log(`  å½“å‰ arr: [${arr()}]`);
                
                try {
                    log('  è°ƒç”¨ arr().push(999)...', 'warning');
                    const result = arr().push(999);
                    log(`  âœ… push è¿”å›: ${result}`, 'success');
                    log(`  ç°åœ¨ arr: [${arr()}]`);
                } catch (e) {
                    log(`  âŒ é”™è¯¯: ${e.message}`, 'error');
                }
            };

            const handleObjIncrement = () => {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'warning');
                log('ğŸ”µ ç‚¹å‡» obj.a++ æŒ‰é’®', 'error');
                log(`  å½“å‰ obj.a: ${obj().a}`);
                
                try {
                    log('  è°ƒç”¨ obj().a++...', 'warning');
                    obj().a++;
                    log(`  âœ… è‡ªå¢å®Œæˆ`, 'success');
                    log(`  ç°åœ¨ obj.a: ${obj().a}`);
                } catch (e) {
                    log(`  âŒ é”™è¯¯: ${e.message}`, 'error');
                }
            };

            const handleReassign = () => {
                log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'warning');
                log('ğŸŸ¢ ç‚¹å‡»é‡æ–°èµ‹å€¼æŒ‰é’®', 'error');
                
                try {
                    log('  è°ƒç”¨ arr([...arr(), 888])...', 'warning');
                    arr([...arr(), 888]);
                    log(`  âœ… é‡æ–°èµ‹å€¼å®Œæˆ`, 'success');
                    log(`  ç°åœ¨ arr: [${arr()}]`);
                } catch (e) {
                    log(`  âŒ é”™è¯¯: ${e.message}`, 'error');
                }
            };

            const template = html`
                <div style="background: #2d2d2d; padding: 20px; border-radius: 8px;">
                    <h2 style="color: #4caf50;">æ¸²æŸ“ #${renderCount}</h2>
                    <div style="margin: 15px 0; padding: 15px; background: #1e1e1e; border-radius: 5px;">
                        <div style="color: #ff9800; font-size: 20px;">
                            æ•°ç»„: [${arr().join(', ')}]
                        </div>
                        <div style="color: #2196f3; font-size: 20px; margin-top: 10px;">
                            å¯¹è±¡: a = ${obj().a}
                        </div>
                    </div>
                    
                    <button onClick=${handlePush}>
                        ğŸ“ arr().push(999)
                    </button>
                    
                    <button onClick=${handleObjIncrement}>
                        â• obj().a++
                    </button>
                    
                    <button onClick=${handleReassign}>
                        ğŸ”„ arr([...arr(), 888])
                    </button>
                </div>
            `;
            
            log(`  âœ… æ¨¡æ¿åˆ›å»ºå®Œæˆ`, 'success');
            return template;
        });

        log('ğŸ¯ å‡†å¤‡æŒ‚è½½ç»„ä»¶...', 'warning');
        const displayDiv = document.getElementById('display');
        displayDiv.innerHTML = '<debug-component></debug-component>';
        
        setTimeout(() => {
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
            log('ğŸ‰ åˆå§‹åŒ–å®Œæˆï¼è¯·ç‚¹å‡»æŒ‰é’®æµ‹è¯•', 'success');
            log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
        }, 100);
    </script>
</body>
</html>

