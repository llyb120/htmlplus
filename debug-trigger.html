<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Trigger ç›‘æ§</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .log {
            background: #2d2d2d;
            padding: 5px 10px;
            margin: 2px 0;
            border-left: 3px solid #007acc;
            font-size: 11px;
        }
        .track { border-left-color: #2196f3; }
        .trigger { border-left-color: #f44336; font-weight: bold; }
        .render { border-left-color: #4caf50; font-weight: bold; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Trigger ç›‘æ§</h1>
    <div id="display"></div>
    <div id="logs" style="max-height: 600px; overflow-y: auto; margin-top: 20px;"></div>

    <script>
        const logs = [];
        function addLog(message, type = 'log') {
            logs.push({ message, type });
            updateLogs();
        }
        
        function updateLogs() {
            document.getElementById('logs').innerHTML = logs.map(l => 
                `<div class="log ${l.type}">${l.message}</div>`
            ).join('');
            const logsDiv = document.getElementById('logs');
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // åœ¨åŠ è½½æ¡†æ¶ä¹‹å‰ï¼Œå‡†å¤‡æ‹¦æˆª
        addLog('å‡†å¤‡åŠ è½½æ¡†æ¶...', 'log');
    </script>
    
    <script src="reactive-lit.js"></script>
    
    <script>
        const { html, createComponent, useState } = window.ReactiveLit;
        addLog('âœ… æ¡†æ¶åŠ è½½å®Œæˆ', 'log');

        // æ‹¦æˆª window ä¸Šçš„ track å’Œ triggerï¼ˆå¦‚æœå¯¼å‡ºçš„è¯ï¼‰
        // ç”±äºå®ƒä»¬åœ¨é—­åŒ…ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ¡†æ¶ä»£ç æ¥å¯¼å‡ºå®ƒä»¬
        // æš‚æ—¶å…ˆæµ‹è¯•åŸºæœ¬åŠŸèƒ½
        
        let renderCount = 0;

        createComponent('test-comp', () => {
            renderCount++;
            addLog(`â”â”â”â” ğŸ¬ æ¸²æŸ“ #${renderCount} â”â”â”â”`, 'render');
            
            const arr = useState([1, 2, 3]);
            addLog(`  è¯»å– arr: [${arr()}]`, 'log');
            
            const obj = useState({ a: 1, b: 2 });
            addLog(`  è¯»å– obj: ${JSON.stringify(obj())}`, 'log');

            const result = html`
                <div style="background: #2d2d2d; padding: 20px;">
                    <h2>æ¸²æŸ“æ¬¡æ•°: ${renderCount}</h2>
                    <h3>arr = [${arr().join(', ')}]</h3>
                    <h3>obj.a = ${obj().a}, obj.b = ${obj().b}</h3>
                    
                    <button onClick=${() => {
                        addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'trigger');
                        addLog('ğŸ”´ æ‰§è¡Œ: arr().push(999)', 'trigger');
                        
                        const arrValue = arr();
                        addLog(`  è·å–åˆ°çš„ arr: [${arrValue}]`, 'log');
                        addLog(`  arr æ˜¯å¦ä¸ºå“åº”å¼: ${arrValue.__isReactive}`, 'log');
                        addLog(`  è°ƒç”¨ push æ–¹æ³•...`, 'log');
                        
                        arrValue.push(999);
                        
                        addLog(`  push åçš„ arr: [${arrValue}]`, 'log');
                        addLog('  ç­‰å¾… DOM æ›´æ–°...', 'log');
                    }}>
                        ğŸ“ arr().push(999)
                    </button>
                    
                    <button onClick=${() => {
                        addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'trigger');
                        addLog('ğŸ”µ æ‰§è¡Œ: obj().a++', 'trigger');
                        
                        const objValue = obj();
                        addLog(`  è·å–åˆ°çš„ obj: ${JSON.stringify(objValue)}`, 'log');
                        addLog(`  obj æ˜¯å¦ä¸ºå“åº”å¼: ${objValue.__isReactive}`, 'log');
                        addLog(`  ä¿®æ”¹ a å±æ€§...`, 'log');
                        
                        objValue.a++;
                        
                        addLog(`  ä¿®æ”¹åçš„ obj: ${JSON.stringify(objValue)}`, 'log');
                        addLog('  ç­‰å¾… DOM æ›´æ–°...', 'log');
                    }}>
                        â• obj().a++
                    </button>
                    
                    <button onClick=${() => {
                        addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'trigger');
                        addLog('ğŸŸ¢ æ‰§è¡Œ: arr([...arr(), 888])', 'trigger');
                        arr([...arr(), 888]);
                        addLog('  é‡æ–°èµ‹å€¼å®Œæˆ', 'log');
                    }}>
                        ğŸ”„ é‡æ–°èµ‹å€¼
                    </button>
                </div>
            `;
            
            return result;
        });

        document.getElementById('display').innerHTML = '<test-comp></test-comp>';
        
        setTimeout(() => {
            addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'log');
            addLog('ğŸ‰ åˆå§‹åŒ–å®Œæˆï¼ç‚¹å‡»æŒ‰é’®æµ‹è¯•', 'log');
        }, 100);
    </script>
</body>
</html>

