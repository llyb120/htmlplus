<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“åº”å¼ç³»ç»Ÿæµ‹è¯•</title>
    <script src="reactive-lit.js" ></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-case {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        .test-case h3 {
            margin-top: 0;
            color: #667eea;
        }
        
        .result {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        .pass {
            color: green;
            font-weight: bold;
        }
        
        .fail {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å“åº”å¼ç³»ç»Ÿæµ‹è¯•</h1>

    <div class="test-case">
        <h3>æµ‹è¯• 1: åŸºç¡€å“åº”å¼æ›´æ–°</h3>
        <p>ç‚¹å‡»æŒ‰é’®ï¼Œè®¡æ•°å™¨åº”è¯¥ç«‹å³æ›´æ–°</p>
        <div id="test1"></div>
        <div class="result" id="test1-result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯• 2: æ‰¹é‡æ›´æ–°ï¼ˆè¿ç»­å¤šæ¬¡ä¿®æ”¹ï¼‰</h3>
        <p>ç‚¹å‡»æŒ‰é’®ä¼šè¿ç»­ä¿®æ”¹ 5 æ¬¡ï¼Œåº”è¯¥åªæ¸²æŸ“ä¸€æ¬¡</p>
        <div id="test2"></div>
        <div class="result" id="test2-result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯• 3: å¤šä¸ªçŠ¶æ€ä¾èµ–</h3>
        <p>ä¿®æ”¹ä»»ä½•ä¸€ä¸ªçŠ¶æ€éƒ½åº”è¯¥è§¦å‘æ›´æ–°</p>
        <div id="test3"></div>
        <div class="result" id="test3-result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯• 4: åµŒå¥—ç»„ä»¶</h3>
        <p>çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶éƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ</p>
        <div id="test4"></div>
        <div class="result" id="test4-result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯• 5: Reactive å¯¹è±¡</h3>
        <p>ä½¿ç”¨ reactive() åˆ›å»ºçš„å¯¹è±¡åº”è¯¥èƒ½è§¦å‘æ›´æ–°</p>
        <div id="test5"></div>
        <div class="result" id="test5-result"></div>
    </div>

    <script>
        // const { html, render, reactive, createComponent, createState } = window.ReactiveLit;

        // æµ‹è¯• 1: åŸºç¡€å“åº”å¼æ›´æ–°
        (() => {
            const container = document.getElementById('test1');
            let renderCount = 0;
            
            createComponent(() => {
                renderCount++;
                const [count, setCount] = createState(0);
                
                const template = html`
                    <div>
                        <p>è®¡æ•°: ${count()}</p>
                        <button onClick=${() => setCount(count() + 1)}>å¢åŠ </button>
                        <p style="color: #999;">æ¸²æŸ“æ¬¡æ•°: ${renderCount}</p>
                    </div>
                `;
                
                render(template, container);
                
                document.getElementById('test1-result').innerHTML = 
                    `åˆå§‹æ¸²æŸ“å®Œæˆã€‚ç‚¹å‡»æŒ‰é’®æµ‹è¯•å“åº”å¼æ›´æ–°ã€‚`;
            }, container);
        })();

        // æµ‹è¯• 2: æ‰¹é‡æ›´æ–°
        (() => {
            const container = document.getElementById('test2');
            let renderCount = 0;
            
            createComponent(() => {
                renderCount++;
                const [count, setCount] = createState(0);
                
                const batchUpdate = () => {
                    const startCount = renderCount;
                    // è¿ç»­ä¿®æ”¹ 5 æ¬¡
                    setCount(count() + 1);
                    setCount(count() + 1);
                    setCount(count() + 1);
                    setCount(count() + 1);
                    setCount(count() + 1);
                    
                    // ç­‰å¾…æ‰¹é‡æ›´æ–°å®Œæˆ
                    setTimeout(() => {
                        const endCount = renderCount;
                        const updates = endCount - startCount;
                        document.getElementById('test2-result').innerHTML = 
                            updates === 1 
                            ? `<span class="pass">âœ… é€šè¿‡ï¼š5æ¬¡ä¿®æ”¹åªè§¦å‘äº†1æ¬¡æ¸²æŸ“</span>`
                            : `<span class="fail">âŒ å¤±è´¥ï¼š5æ¬¡ä¿®æ”¹è§¦å‘äº†${updates}æ¬¡æ¸²æŸ“</span>`;
                    }, 100);
                };
                
                const template = html`
                    <div>
                        <p>è®¡æ•°: ${count()}</p>
                        <button onClick=${batchUpdate}>æ‰¹é‡ä¿®æ”¹5æ¬¡</button>
                        <p style="color: #999;">æ¸²æŸ“æ¬¡æ•°: ${renderCount}</p>
                    </div>
                `;
                
                render(template, container);
            }, container);
        })();

        // æµ‹è¯• 3: å¤šä¸ªçŠ¶æ€ä¾èµ–
        (() => {
            const container = document.getElementById('test3');
            let renderCount = 0;
            
            createComponent(() => {
                renderCount++;
                const [firstName, setFirstName] = createState('å¼ ');
                const [lastName, setLastName] = createState('ä¸‰');
                
                const template = html`
                    <div>
                        <p>å§“å: ${firstName()}${lastName()}</p>
                        <button onClick=${() => setFirstName('æ')}>æ”¹å§“</button>
                        <button onClick=${() => setLastName('å››')}>æ”¹å</button>
                        <p style="color: #999;">æ¸²æŸ“æ¬¡æ•°: ${renderCount}</p>
                    </div>
                `;
                
                render(template, container);
                
                document.getElementById('test3-result').innerHTML = 
                    `ç‚¹å‡»ä»»ä¸€æŒ‰é’®ï¼Œå§“åéƒ½åº”è¯¥æ›´æ–°ã€‚`;
            }, container);
        })();

        // æµ‹è¯• 4: åµŒå¥—ç»„ä»¶
        (() => {
            const parentContainer = document.getElementById('test4');
            let parentRenderCount = 0;
            let childRenderCount = 0;
            
            // çˆ¶ç»„ä»¶
            createComponent(() => {
                parentRenderCount++;
                const [parentCount, setParentCount] = createState(0);
                
                const template = html`
                    <div style="padding: 15px; background: #e3f2fd; border-radius: 5px;">
                        <h4>çˆ¶ç»„ä»¶</h4>
                        <p>çˆ¶è®¡æ•°: ${parentCount()}</p>
                        <button onClick=${() => setParentCount(parentCount() + 1)}>çˆ¶+1</button>
                        <p style="color: #999;">çˆ¶æ¸²æŸ“æ¬¡æ•°: ${parentRenderCount}</p>
                        
                        <div id="child-container" style="margin-top: 15px;"></div>
                    </div>
                `;
                
                render(template, parentContainer);
                
                // å­ç»„ä»¶
                const childContainer = document.getElementById('child-container');
                if (childContainer && childRenderCount === 0) {
                    createComponent(() => {
                        childRenderCount++;
                        const [childCount, setChildCount] = createState(0);
                        
                        const childTemplate = html`
                            <div style="padding: 15px; background: #fff3e0; border-radius: 5px;">
                                <h4>å­ç»„ä»¶</h4>
                                <p>å­è®¡æ•°: ${childCount()}</p>
                                <button onClick=${() => setChildCount(childCount() + 1)}>å­+1</button>
                                <p style="color: #999;">å­æ¸²æŸ“æ¬¡æ•°: ${childRenderCount}</p>
                            </div>
                        `;
                        
                        render(childTemplate, childContainer);
                    }, childContainer);
                }
                
                document.getElementById('test4-result').innerHTML = 
                    `çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶åº”è¯¥ç‹¬ç«‹å·¥ä½œï¼Œäº’ä¸å½±å“ã€‚`;
            }, parentContainer);
        })();

        // æµ‹è¯• 5: Reactive å¯¹è±¡
        (() => {
            const container = document.getElementById('test5');
            let renderCount = 0;
            
            createComponent(() => {
                renderCount++;
                const state = reactive({
                    user: {
                        name: 'å¼ ä¸‰',
                        age: 25
                    },
                    count: 0
                });
                
                const template = html`
                    <div>
                        <p>å§“å: ${state.user.name}, å¹´é¾„: ${state.user.age}</p>
                        <p>è®¡æ•°: ${state.count}</p>
                        <button onClick=${() => state.user.name = 'æå››'}>æ”¹å</button>
                        <button onClick=${() => state.user.age++}>å¹´é¾„+1</button>
                        <button onClick=${() => state.count++}>è®¡æ•°+1</button>
                        <p style="color: #999;">æ¸²æŸ“æ¬¡æ•°: ${renderCount}</p>
                    </div>
                `;
                
                render(template, container);
                
                document.getElementById('test5-result').innerHTML = 
                    `ä¿®æ”¹ reactive å¯¹è±¡çš„ä»»ä½•å±æ€§éƒ½åº”è¯¥è§¦å‘æ›´æ–°ã€‚`;
            }, container);
        })();
    </script>
</body>
</html>

